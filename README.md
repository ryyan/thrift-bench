# thrift-benchmark

Project used to benchmark performance for Thrift in different languages.

## Layout

- Dockerfile: Environment setup.
- echo.thrift: Thrift contract for echo service.
  - Using a struct with optional string to simulate a little complexity.
- go & py: Go and Python thrift client/server code.
  - Attempted to mirror both codebases as closely as possible.
    - Same thrift protocols, transports; same number of concurrent client connections, etc
- gen-go & gen-py: Autogenerated code created with Thrift.

## Prereqs

- Install [docker](https://docs.docker.com/)
- Install [thrift](https://thrift.apache.org/docs/install/)
  - Optional. Use to re-generate the thrift files (gen-go & gen-py)
    - `thrift -r --gen go --gen py echo.thrift`

## Setup

### Build and run docker image

This could take a few minutes

```
sudo docker build -t thrift-benchmark --no-cache .

sudo docker run -it --rm \
  -v "$PWD"/go:/go/src/go \
  -v "$PWD"/gen-go/echo:/go/src/echo \
  -v "$PWD"/py:/py/py \
  -v "$PWD"/gen-py/echo:/py/echo \
  -v "$PWD"/echo.thrift:/echo.thrift \
  thrift-benchmark bash
```

### Build within docker image

```
echo Building go code...
cd /go/src/go
go get && go build

echo Building python code...
cd /py
python3 -m compileall -f .
echo Build complete!
```

## Run benchmarks within docker image

View the current results [here](RESULTS.md)

### Go server & client

```
cd /go/src/go
./go -server &
./go -num 1000
```

### Python server & client

```
cd /py/py
python3 server.pyc &
python3 client.pyc 1000
```
